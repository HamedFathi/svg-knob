var t={light:{bg_color:"#E0E0E0",bg_border_color:"#BDBDBD",track_bg_color:"#CFD8DC",track_color_init:"#64B5F6",track_color:"#42A5F5",cursor_color_init:"#64B5F6",cursor_color:"#42A5F5",markers_color:"#9E9E9E",font_color:"#424242"},light2:{bg_color:"#B1DAEE",bg_border_color:"#569DC0",track_bg_color:"#B1DAEE",track_color_init:"#569DC0",track_color:"#1D6D93",cursor_color_init:"#569DC0",cursor_color:"#1D6D93",markers_color:"#3680A4",font_color:"#1D6D93"},dark:{bg_color:"#000000",bg_border_color:"#569DC0",track_bg_color:"#424242",track_color_init:"#FDD835",track_color:"#FFEC00",cursor_color_init:"#569DC0",cursor_color:"#FDD835",markers_color:"#3680A4",font_color:"#FFEA00"}};export default function(e,r){if(void 0===r&&(r={}),!e)throw"You must pass a DOM node reference to the Knob constructor";var a,n=!1,o="http://www.w3.org/2000/svg",l=!0,i=!l,s=50,c=50;("string"==typeof e||e instanceof String)&&(e=document.querySelector(e)),"svg"===e.nodeName.toLowerCase()?a=e:(a=document.createElementNS("http://www.w3.org/2000/svg","svg"),e.appendChild(a));var u,_={label:!1,rotation:l,default_value:0,initial_value:0,value_min:0,value_max:100,value_resolution:1,center_zero:!1,center_value:null,center_gap:4,zero_at:270,angle_min:30,angle_max:330,bg_radius:32,bg_border_width:1,track_bg_radius:40,track_bg_width:8,track_radius:40,track_width:8,cursor_radius:18,cursor_length:10,cursor_width:4,palette:"light",bg:!1,track_bg:!0,track:!0,cursor:!1,linecap:"butt",value_text:!0,value_position:c+8,font_family:"sans-serif",font_size:25,display_raw:!1,format_raw:function(t){return Math.round(t)},format:function(t){return t},font_weight:"bold",markers:0,markers_radius:40,markers_length:8,markers_width:2,class_bg:"knob-bg",class_track_bg:"knob-track-bg",class_track:"knob-track",class_value:"knob-value",class_cursor:"knob-cursor",class_markers:"knob-markers",snap_to_steps:!1,mouse_wheel_acceleration:1,onchange:null},d=JSON.parse(e.dataset.config||"{}"),g=Object.assign({},_,t[_.palette],r,d),b=Object.assign(g,t[g.palette],r,d);u=b.label||b.value_position>=100-b.font_size/2?120:100,a.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),a.setAttributeNS(null,"viewBox","0 0 100 "+u);var m,h,k=0,v=0,f=0,p=0,w=b.angle_min,A=null,x=null,E=null,D=null,M=null,S=null,N=null,C=null,y=!1;function F(){n&&console.log("init()"),b.center_zero&&(b.center_value||(b.center_value=P((b.value_max-b.value_min)/2+b.value_min))),"butt"===b.linecap?(f=Y(180*Math.acos(-b.center_gap/100)/Math.PI),p=Y(180*Math.acos(b.center_gap/100)/Math.PI)):(f=Y(180*Math.acos(-(1.3*b.track_width+b.center_gap)/100)/Math.PI),p=Y(180*Math.acos((1.3*b.track_width+b.center_gap)/100)/Math.PI))}function L(){T(b.initial_value?b.initial_value:b.default_value)}function P(t){return null===b.value_resolution?t:Math.round(t/b.value_resolution)*b.value_resolution}function z(t){n&&console.log("getDisplayValue",b.display_raw);var e=I(t);return b.display_raw?b.format_raw(e):b.format(e)}function B(){var t;return t=Math.abs(b.value_max-b.value_min),1===Math.abs(t%2)?.5:0}function I(t){return P(((void 0===t?w:t)-b.angle_min)/(b.angle_max-b.angle_min)*(b.value_max-b.value_min)+b.value_min-B())}function T(t){return O((t+B()-b.value_min)/(b.value_max-b.value_min)*(b.angle_max-b.angle_min)+b.angle_min),n&&console.log("setValue("+t+") angle="+(t-b.value_min)/(b.value_max-b.value_min)*(b.angle_max-b.angle_min)+b.angle_min),!0}function O(t,r){var a=w,o=r&&t!==w;w=Math.min(Math.max(t,b.angle_min),b.angle_max),o&&I(a)!==I()&&function(){n&&console.log("knob value has changed");var t=I(),r=new CustomEvent("change",{detail:t});e.dispatchEvent(r),b.onchange&&b.onchange(t)}()}function V(t){var e=b.zero_at-t;return e<0&&(e+=360),n&&console.log("knobToPolarAngle "+t+" -> "+e),e}function Y(t){return n&&console.log("polarToKnobAngle "+t+" -> "+(b.zero_at-t+360)%360),(b.zero_at-t+360)%360}function j(t){var e=t.clientX-m.left,r=t.clientY-m.top,a=(e-k)/(m.width/2),o=-(r-v)/(m.width/2);b.rotation===i&&(a=-a);var l=Math.atan2(o,a);l<0&&(l=2*Math.PI+l),n&&console.log("mouseUpdate: position in svg = "+e+", "+r+" pixels; "+a.toFixed(3)+", "+o.toFixed(3)+" rel.; angle "+l.toFixed(3)+" rad"),O(Y(180*l/Math.PI),!0)}function K(t){t.preventDefault(),j(t),W()}function R(){n&&console.log("endDrag"),document.removeEventListener("mousemove",K,!1),document.removeEventListener("mouseup",R,!1)}function X(t){n&&console.log("handleTouch",t.touches),t.preventDefault();var e=t.touches.length-1,r=t.touches[e].clientX-m.left,a=t.touches[e].clientY-m.top,o=(r-k)/(m.width/2),l=-(a-v)/(m.width/2);b.rotation===i&&(o=-o);var s=Math.atan2(l,o);s<0&&(s=2*Math.PI+s),n&&console.log("handleTouch: position in svg = "+r+", "+a+" pixels; "+o.toFixed(3)+", "+l.toFixed(3)+" rel.; angle "+s.toFixed(3)+" rad"),O(Y(180*s/Math.PI),!0),W()}function q(){n&&console.log("endTouch"),document.removeEventListener("touchmove",X),document.removeEventListener("touchend",q)}function H(t,e){var r=t*Math.PI/180,a=void 0===e?b.track_radius:e,n=Math.cos(r)*a,o=Math.sin(r)*a;return{x:b.rotation===l?s+n:s-n,y:c-o}}function J(t,e,r){n&&console.group("getArc("+t+", "+e+", "+r+")");var a=V(t),o=V(e);t!==e&&(a-=1e-4,o+=1e-4);var i=H(a,r),s=i.x,c=i.y,u=H(o,r),_="M "+s+","+c+" A "+r+","+r+" 0 "+((a-o+360)%360<180?0:1)+","+(b.rotation===l?1:0)+" "+u.x+","+u.y;return n&&console.groupEnd(),n&&console.log("arc: "+_),_}function U(){n&&console.log("getTrackPath()");var t=null;if(b.center_zero){if(Array.isArray(b.center_value)){if(b.center_value.includes(I()))return n&&console.log("getTrackPath: center position, track not drawn"),t}else if(I()===b.center_value)return n&&console.log("getTrackPath: center position, track not drawn"),t;w<180?t=J(Math.min(w,f),f,b.track_radius):w>180&&(t=J(p,Math.max(w,p),b.track_radius))}else t=J(b.angle_min,w,b.track_radius);return t}function G(){if(n&&console.log("draw_track()",b.track),b.track){var t=U();t&&((M=document.createElementNS(o,"path")).setAttributeNS(null,"d",t),M.setAttribute("stroke",""+b.track_color_init),M.setAttribute("stroke-width",""+b.track_width),M.setAttribute("fill","transparent"),M.setAttribute("stroke-linecap",b.linecap),M.setAttribute("class",b.class_track),a.appendChild(M))}}function Q(){var t=V(w),e=H(t,b.cursor_radius),r=H(t,b.cursor_radius+b.cursor_length);return"M "+e.x+","+e.y+" L "+r.x+","+r.y}function W(){n&&console.log("redraw()",b);var t=U();t?M?(n&&console.log("redraw track already exist, update d"),M.setAttributeNS(null,"d",t)):(n&&console.log("redraw draw_track"),G()):M&&(n&&console.log("redraw track already exist, hide it"),M.setAttributeNS(null,"d","")),y||(y=I()!==b.default_value)&&M&&M.setAttribute("stroke",""+b.track_color),S&&(t=Q())&&(n&&console.log("redraw cursor"),S.setAttributeNS(null,"d",t),y&&S.setAttribute("stroke",""+b.cursor_color)),C&&(n&&console.log("redraw svg_value_text"),C.textContent=z())}return F(),L(),n&&console.log("draw()",b),n&&console.log("draw_background()",b.bg),b.bg&&((A=document.createElementNS(o,"circle")).setAttributeNS(null,"cx",""+s),A.setAttributeNS(null,"cy",""+c),A.setAttributeNS(null,"r",""+b.bg_radius),A.setAttribute("fill",""+b.bg_color),A.setAttribute("stroke",""+b.bg_border_color),A.setAttribute("stroke-width",""+b.bg_border_width),A.setAttribute("class",b.class_bg),a.appendChild(A)),n&&console.log("draw_track_background()",b.track_bg),b.track_bg&&(b.center_zero?((E=document.createElementNS(o,"path")).setAttributeNS(null,"d",J(b.angle_min,f,b.track_bg_radius)),E.setAttribute("stroke",""+b.track_bg_color),E.setAttribute("stroke-width",""+b.track_bg_width),E.setAttribute("stroke-linecap",b.linecap),E.setAttribute("fill","transparent"),E.setAttribute("class",b.class_track_bg),a.appendChild(E),(D=document.createElementNS(o,"path")).setAttributeNS(null,"d",J(p,b.angle_max,b.track_bg_radius)),D.setAttribute("stroke",""+b.track_bg_color),D.setAttribute("stroke-width",""+b.track_bg_width),D.setAttribute("stroke-linecap",b.linecap),D.setAttribute("fill","transparent"),D.setAttribute("class",b.class_track_bg),a.appendChild(D)):((x=document.createElementNS(o,"path")).setAttributeNS(null,"d",J(b.angle_min,b.angle_max,b.track_bg_radius)),x.setAttribute("stroke",""+b.track_bg_color),x.setAttribute("stroke-width",""+b.track_bg_width),x.setAttribute("fill","transparent"),x.setAttribute("stroke-linecap",b.linecap),x.setAttribute("class",b.class_track_bg),a.appendChild(x))),function(){if(n&&console.log("draw_markers()",b.markers),b.markers){for(var t="",e=(b.angle_max-b.angle_min)/b.markers,r=b.angle_min;r<=b.angle_max;r+=e){var l=H(V(r),b.markers_radius),i=H(V(r),b.markers_radius+b.markers_length);t+="M "+l.x+","+l.y+" L "+i.x+","+i.y+" "}(N=document.createElementNS(o,"path")).setAttributeNS(null,"d",t),N.setAttribute("stroke",""+b.markers_color),N.setAttribute("stroke-width",""+b.markers_width),N.setAttribute("stroke-linecap",b.linecap),N.setAttribute("class",b.class_markers),a.appendChild(N)}}(),G(),function(){if(n&&console.log("draw_cursor()",b.cursor),b.cursor){var t=Q();t&&((S=document.createElementNS(o,"path")).setAttributeNS(null,"d",t),S.setAttribute("stroke",""+b.cursor_color_init),S.setAttribute("stroke-width",""+b.cursor_width),S.setAttribute("fill","transparent"),S.setAttribute("stroke-linecap",b.linecap),S.setAttribute("class",b.class_cursor),a.appendChild(S))}}(),n&&console.log("draw_value",b.value_text),b.value_text&&((C=document.createElementNS(o,"text")).setAttributeNS(null,"x",""+s),C.setAttributeNS(null,"y",""+b.value_position),C.setAttribute("text-anchor","middle"),C.setAttribute("cursor","default"),C.setAttribute("font-family",b.font_family),C.setAttribute("font-size",""+b.font_size),C.setAttribute("font-weight",""+b.font_weight),C.setAttribute("fill",b.font_color),C.setAttribute("class",b.class_value),C.textContent=z(),a.appendChild(C)),n&&console.log("attach attachEventHandlers"),a.addEventListener("mousedown",function(t){!function(t){n&&console.log("startDrag"),t.preventDefault(),m=a.getBoundingClientRect(),v=k=m.width/2,document.addEventListener("mousemove",K,!1),document.addEventListener("mouseup",R,!1),j(t),W()}(t)}),a.addEventListener("wheel",function(t){!function(t){t.preventDefault();var e=t.deltaY;0!==e&&(h>Math.abs(e)||!h)&&(h=Math.abs(e)),O(Math.min(Math.max(w+e/h*1*b.mouse_wheel_acceleration,b.angle_min),b.angle_max),!0),W()}(t)}),a.addEventListener("touchstart",function(t){n&&console.log("startTouch"),t.preventDefault(),m=a.getBoundingClientRect(),v=k=m.width/2,document.addEventListener("touchmove",X,{passive:!1}),document.addEventListener("touchend",q)},{passive:!1}),{set value(t){T(t),W()},set config(t){b=Object.assign({},_,b,t),F(),W()},setConfigValue:function(t,e){b[t]=e,F(),W()},initValue:L,enableDebug:function(){n=!0},disableDebug:function(){n=!1}}}
//# sourceMappingURL=main.mjs.map
